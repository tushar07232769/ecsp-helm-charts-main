replicaCount: 2

image:
  repository: docker.io/eclipseecsp/uidam-authorization-server
  pullPolicy: IfNotPresent
  tag: 1.0.0

nameOverride: ""
fullnameOverride: ""

podAnnotations: {}

podSecurityContext: {}

securityContext: {}

tenant:
  tenantId: "tenant-001"
  tenantName: "example-tenant"
  jksEnabled: "true"
  alias: "uidamauthserver"
  cache:
    expiration: "60"
    maxsize: "100"
    clientids: "token-mgmt,device-mgmt"
  account:
    accountId: "acc-001"
    accountName: "example-account"
    accountType: "B2B"
    accountFieldEnabled: "true"
  client:
    accessTokenTtl: "3600"
    idTokenTtl: "3600"
    refreshTokenTtl: "86400"
    authCodeTtl: "300"
    oauthScopeCustomization: "false"
  user:
    captchaAfterInvalidFailures: "1"
    captchaRequired: "false"
    maxAllowedLoginAttempts: "5"
    jwtAdditionalClaimAttributes: "accountType, accountName"
  externalUrls:
    userManagementUrl: "http://uidam-user-management:8080"
    clientByClientIdEndpoint: "/v1/oauth2/client/{clientId}"
    userByUsernameEndpoint: "/v1/users/{userName}/byUserName"
    recoveryNotificationEndpoint: "/v1/users/{userName}/recovery/forgotpassword"
    updatePasswordUsingSecretEndpoint: "/v1/users/recovery/set-password"
  keyStore:
    keyStoreFilename: "uidamauthserver.jks"
    keyAlias: "uidamauthserver"
    keyType: "JKS"
  cert:
    jwtPublicKey: "app.pub"
    jwtPrivateKey: "app.key"
    jwtKeyId: "jwt-key-001"
  captcha:
    recaptchaVerifyUrl: "https://www.google.com/recaptcha/api/siteverify"
    recaptchaKeySite: "recaptcha-site-key"
  externalIdpEnabled: true
  internalLoginEnabled: true
  externalIdpClientName: federated-user-client
  externalIdpRegisteredClients:
    - clientName: Google
      registrationId: google
      clientId: google-client-id
      clientSecret: google-client-secret
      clientAuthenticationMethod: client_secret_basic
      scope: openid, profile, email, address, phone
      authorizationUri: https://accounts.google.com/o/oauth2/v2/auth
      tokenUri: https://www.googleapis.com/oauth2/v4/token
      userInfoUri: https://www.googleapis.com/oauth2/v3/userinfo
      userNameAttributeName: sub
      jwkSetUri: https://www.googleapis.com/oauth2/v3/certs
      tokenInfoSource: FETCH_INTERNAL_USER
      createUserMode: CREATE_INTERNAL_USER
      defaultUserRoles: VEHICLE_OWNER
      claimMappings: firstName#given_name,lastName#family_name,email#email
    - clientName: Github
      registrationId: github
      clientId: github-client-id
      clientSecret: github-client-secret
      clientAuthenticationMethod: client_secret_basic
      scope: read:user
      authorizationUri: https://github.com/login/oauth/authorize
      tokenUri: https://github.com/login/oauth/access_token
      userInfoUri: https://api.github.com/user
      userNameAttributeName: id
      jwkSetUri: https://www.googleapis.com/oauth2/v3/certs
      tokenInfoSource: FETCH_INTERNAL_USER
      createUserMode: CREATE_INTERNAL_USER
      defaultUserRoles: VEHICLE_OWNER
      claimMappings: firstName#name,email#email
    - clientName: Cognito
      registrationId: cognito
      clientId: cognito-client-id
      clientSecret: cognito-client-secret
      clientAuthenticationMethod: client_secret_basic
      scope: openid,profile
      authorizationUri: https://your-cognito-domain/oauth2/authorize
      tokenUri: https://your-cognito-domain/oauth2/token
      userInfoUri: https://your-cognito-domain/oauth2/userinfo
      userNameAttributeName: sub
      jwkSetUri: https://your-cognito-domain/.well-known/jwks.json
      tokenInfoSource: FETCH_INTERNAL_USER
      createUserMode: CREATE_INTERNAL_USER
      defaultUserRoles: VEHICLE_OWNER
      claimMappings: firstName#given_name,lastName#family_name,email#email
    - clientName: Azure
      registrationId: azureidp
      clientId: azure-client-id
      clientSecret: azure-client-secret
      clientAuthenticationMethod: client_secret_post
      scope: openid
      authorizationUri: https://login.microsoftonline.com/common/oauth2/v2.0/authorize
      tokenUri: https://login.microsoftonline.com/common/oauth2/v2.0/token
      userInfoUri: https://graph.microsoft.com/oidc/userinfo
      userNameAttributeName: sub
      jwkSetUri: https://login.microsoftonline.com/common/discovery/v2.0/keys
      tokenInfoSource: FETCH_INTERNAL_USER
      createUserMode: CREATE_INTERNAL_USER
      defaultUserRoles: VEHICLE_OWNER
      claimMappings: firstName#given_name,lastName#family_name,email#email

service:
  type: ClusterIP
  port: 9443

ingress:
  enabled: true
  className: alb
  groupName: external
  scheme: internet-facing
  targetType: ip
  inboundCidrs: ["0.0.0.0/0"]
  tls:
    enabled: true
    sslRedirect: false
  additionalAnnotations: {}
  hosts:
    - hostPrefix: auth-server
      paths:
        - /

resources: {}

nodeSelector: {}

tolerations: []

affinity: {}

distributedTracing:
  enabled: false

environmentDomainName: ecsp.example.com

uiTemplatePath: "file:///tmp/customui/templates/"
uiStaticPath: "file:///tmp/customui/static"
javaOpts: -Xms128m -Xmx512m -XX:+UseG1GC -XX:+UseStringDeduplication -XX:MaxMetaspaceSize=256m

logging:
  GRAYLOG_ENABLED: "false"
  GRAYLOG_HOST: graylog3-tcp.graylog.svc.cluster.local
  GRAYLOG_PORT: "12201"
  NEVER_BLOCK_FOR_GRAYLOG: "false"
  LOG_FOLDER: logs/
  LOG_LEVEL: ERROR
  IGNITE_LOG_LEVEL: ERROR
  SVC_LOG_LEVEL: INFO
  STORAGE_LOG_LEVEL: ERROR
  SPRING_LOG_LEVEL: ERROR
  LOG_APPENDER: "STDOUT"

postgres:
  host: postgresql
  port: 5432
  secretName: uidam-authorization-server-credentials
  userName: uidamuser
  password: uidampass
  databaseName: postgresql
  schemaName: eclipseecsp
  max_idle_time: "0"
  data_source_properties:
    cachePrepStmts: "true"
    prepStmtCacheSize: "250"
    prepStmtCacheSqlLimit: "2048"
  connecion_timeout_ms: "60000"
  expected99thPercentileMs: "60000"
  max_pool_size: "30"

server_servlet_session_timeout: "5m"
user_session_force_login: "true"

health:
  postgresdb:
    monitor:
      enabled: "true"
      restart_on_failure: "true"

metrics:
  prometheus:
    enabled: "true"
    agent:
      port: "9100"
      port_exposed: "9100"
  postgresdb:
    enabled: "true"
    executor_shutdown_buffer_ms: "2000"
    thread:
      freq_ms: "5000"
      intial_delay_ms: "2000"

jks_file: uidamauthserver.jks
nfsServerUrl: nfs.example.com:/shared
sharedStoragePvcName: uidam-shared-storage

app_key: |
  -----BEGIN PRIVATE KEY-----
  TO-BE-REPLACED-WITH-REAL-KEY
  -----END PRIVATE KEY-----

app_pub: |
  -----BEGIN PUBLIC KEY-----
  TO-BE-REPLACED-WITH-REAL-KEY
  -----END PUBLIC KEY-----

uidam_pub: |
  -----BEGIN PUBLIC KEY-----
  TO-BE-REPLACED-WITH-REAL-KEY
  -----END PUBLIC KEY-----

secrets:
  keystorePassword: "changeit"
  igniteRecaptchaKeySecret: "<recaptcha-secret>"
  clientsecretkey: "<client-secret-key>"
  clientsecretsalt: "<client-secret-salt>"
  clientSecret: "<oauth-client-secret>"
